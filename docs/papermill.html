<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="/assets/images/favicon-32.png" type="image/x-icon" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>papermill | Machine Learning Ops</title>
<meta name="generator" content="Jekyll v4.1.0" />
<meta property="og:title" content="papermill" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Refresh Jupyter Notebooks With Papermill papermill is a great project for running notebooks programatically. You can pass parameters to notebooks, use different kernels, etc. Example: refresh notebooks every 6 hours Put a shell script at the location_action_files/run_notebooks.sh with the following contents: #!/bin/sh set -e cd $(dirname &quot;$0&quot;)/.. cd _notebooks/ ERRORS=&quot;&quot; # Loop through all notebooks and run them with papermill for file in *.ipynb do if papermill --kernel python3 &quot;${file}&quot; &quot;${file}&quot;; then echo &quot;Sucessfully refreshed ${file}\n\n\n\n&quot; else echo &quot;ERROR Refreshing ${file}&quot; ERRORS=&quot;${ERRORS}, ${file}&quot; fi done # Emit Errors If Exists So Downstream Task Can Open An Issue if [ -z &quot;$ERRORS&quot; ] then echo &quot;::set-output name=error_bool::false&quot; else echo &quot;These files failed to update properly: ${ERRORS}&quot; echo &quot;::set-output name=error_bool::true&quot; echo &quot;::set-output name=error_str::${ERRORS}&quot; fi In the location .github/workflows/update-nb.yaml define an Actions workflow with the following contents name: Update Notebooks And Refresh Page on: schedule: - cron: &#39;0 */6 * * *&#39; jobs: update-notebooks: runs-on: ubuntu-latest steps: - name: Copy Repository Contents uses: actions/checkout@v2 - name: Set up Python uses: actions/setup-python@v1 with: python-version: 3.6 - name: install dependencies run: | pip3 install -r ./_notebooks/requirements.txt python3 -m ipykernel install --user --name python3 sudo chmod -R 777 . - name: update notebooks id: update_nb run: | ./_action_files/run_notebooks.sh - name: Create an issue if notebook update failure occurs if: steps.update_nb.outputs.error_bool == &#39;true&#39; uses: actions/github-script@0.6.0 with: github-token: $ script: | var err = process.env.ERROR_STRING; var run_id = process.env.RUN_ID; github.issues.create({ owner: context.repo.owner, repo: context.repo.repo, title: &quot;Error updating notebooks&quot;, body: `These are the notebooks that failed to update properly: \n${err}\n\n See run [${run_id}](https://github.com/github/covid19-dashboard/actions/runs/${run_id}) for more details.` }) env: ERROR_STRING: $ RUN_ID: $ This example is based on covid19dashboards.com, which uses fastpages and papermill to refresh notebooks and serve them as dasbhoards. You can see browse the workflow files of this project to see how papermill is used." />
<meta property="og:description" content="Refresh Jupyter Notebooks With Papermill papermill is a great project for running notebooks programatically. You can pass parameters to notebooks, use different kernels, etc. Example: refresh notebooks every 6 hours Put a shell script at the location_action_files/run_notebooks.sh with the following contents: #!/bin/sh set -e cd $(dirname &quot;$0&quot;)/.. cd _notebooks/ ERRORS=&quot;&quot; # Loop through all notebooks and run them with papermill for file in *.ipynb do if papermill --kernel python3 &quot;${file}&quot; &quot;${file}&quot;; then echo &quot;Sucessfully refreshed ${file}\n\n\n\n&quot; else echo &quot;ERROR Refreshing ${file}&quot; ERRORS=&quot;${ERRORS}, ${file}&quot; fi done # Emit Errors If Exists So Downstream Task Can Open An Issue if [ -z &quot;$ERRORS&quot; ] then echo &quot;::set-output name=error_bool::false&quot; else echo &quot;These files failed to update properly: ${ERRORS}&quot; echo &quot;::set-output name=error_bool::true&quot; echo &quot;::set-output name=error_str::${ERRORS}&quot; fi In the location .github/workflows/update-nb.yaml define an Actions workflow with the following contents name: Update Notebooks And Refresh Page on: schedule: - cron: &#39;0 */6 * * *&#39; jobs: update-notebooks: runs-on: ubuntu-latest steps: - name: Copy Repository Contents uses: actions/checkout@v2 - name: Set up Python uses: actions/setup-python@v1 with: python-version: 3.6 - name: install dependencies run: | pip3 install -r ./_notebooks/requirements.txt python3 -m ipykernel install --user --name python3 sudo chmod -R 777 . - name: update notebooks id: update_nb run: | ./_action_files/run_notebooks.sh - name: Create an issue if notebook update failure occurs if: steps.update_nb.outputs.error_bool == &#39;true&#39; uses: actions/github-script@0.6.0 with: github-token: $ script: | var err = process.env.ERROR_STRING; var run_id = process.env.RUN_ID; github.issues.create({ owner: context.repo.owner, repo: context.repo.repo, title: &quot;Error updating notebooks&quot;, body: `These are the notebooks that failed to update properly: \n${err}\n\n See run [${run_id}](https://github.com/github/covid19-dashboard/actions/runs/${run_id}) for more details.` }) env: ERROR_STRING: $ RUN_ID: $ This example is based on covid19dashboards.com, which uses fastpages and papermill to refresh notebooks and serve them as dasbhoards. You can see browse the workflow files of this project to see how papermill is used." />
<link rel="canonical" href="https://mlops-github.com/docs/papermill" />
<meta property="og:url" content="https://mlops-github.com/docs/papermill" />
<meta property="og:site_name" content="Machine Learning Ops" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-16T14:51:57-05:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://mlops-github.com/docs/papermill"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://mlops-github.com/assets/images/Data-driven-recommendations.png"}},"description":"Refresh Jupyter Notebooks With Papermill papermill is a great project for running notebooks programatically. You can pass parameters to notebooks, use different kernels, etc. Example: refresh notebooks every 6 hours Put a shell script at the location_action_files/run_notebooks.sh with the following contents: #!/bin/sh set -e cd $(dirname &quot;$0&quot;)/.. cd _notebooks/ ERRORS=&quot;&quot; # Loop through all notebooks and run them with papermill for file in *.ipynb do if papermill --kernel python3 &quot;${file}&quot; &quot;${file}&quot;; then echo &quot;Sucessfully refreshed ${file}\\n\\n\\n\\n&quot; else echo &quot;ERROR Refreshing ${file}&quot; ERRORS=&quot;${ERRORS}, ${file}&quot; fi done # Emit Errors If Exists So Downstream Task Can Open An Issue if [ -z &quot;$ERRORS&quot; ] then echo &quot;::set-output name=error_bool::false&quot; else echo &quot;These files failed to update properly: ${ERRORS}&quot; echo &quot;::set-output name=error_bool::true&quot; echo &quot;::set-output name=error_str::${ERRORS}&quot; fi In the location .github/workflows/update-nb.yaml define an Actions workflow with the following contents name: Update Notebooks And Refresh Page on: schedule: - cron: &#39;0 */6 * * *&#39; jobs: update-notebooks: runs-on: ubuntu-latest steps: - name: Copy Repository Contents uses: actions/checkout@v2 - name: Set up Python uses: actions/setup-python@v1 with: python-version: 3.6 - name: install dependencies run: | pip3 install -r ./_notebooks/requirements.txt python3 -m ipykernel install --user --name python3 sudo chmod -R 777 . - name: update notebooks id: update_nb run: | ./_action_files/run_notebooks.sh - name: Create an issue if notebook update failure occurs if: steps.update_nb.outputs.error_bool == &#39;true&#39; uses: actions/github-script@0.6.0 with: github-token: $ script: | var err = process.env.ERROR_STRING; var run_id = process.env.RUN_ID; github.issues.create({ owner: context.repo.owner, repo: context.repo.repo, title: &quot;Error updating notebooks&quot;, body: `These are the notebooks that failed to update properly: \\n${err}\\n\\n See run [${run_id}](https://github.com/github/covid19-dashboard/actions/runs/${run_id}) for more details.` }) env: ERROR_STRING: $ RUN_ID: $ This example is based on covid19dashboards.com, which uses fastpages and papermill to refresh notebooks and serve them as dasbhoards. You can see browse the workflow files of this project to see how papermill is used.","@type":"BlogPosting","url":"https://mlops-github.com/docs/papermill","headline":"papermill","dateModified":"2020-06-16T14:51:57-05:00","datePublished":"2020-06-16T14:51:57-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://mlops-github.com/feed.xml" title="Machine Learning Ops" /><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57531313-6', 'auto');
  ga('send', 'pageview');
}
</script>
  
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
   <style>
    body {
      background: #1b1f23;
    }
  </style>
</head><body class="doc_page"><header class="site-header" role="banner">
  <div class="navbar">

    <div class="logo">
      <!-- <img src="/assets/images/Data-driven-recommendations.png" alt="logo"> --><svg aria-hidden="true" class="indexesm__StyledOcticon-sc-1ao7p5-27 xrdzL" height="32" role="img" viewBox="0 0 16 16" width="32" style="display:inline-block;fill:currentColor;user-select:none;vertical-align:text-bottom"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg><a href="/">
        <span>Machine Learning Ops</span>
      </a>
    </div>

    <nav class="navigation hidden" id="navigation">
      
      <a href="/blog" >Blog Posts</a>
      
      <a href="/actions" >GitHub Actions</a>
      
      <a href="/examples" >Examples</a>
      
      <a href="/talks" >Talks</a>
      
      <a href="/docs" >Docs</a>
      
      <a href="/team" >Team</a></nav>

    <button class="toggle_mnu" id="toggle_menu" onclick="toggle_menu()">
      <img src="/assets/images/sandwich_white.png" class="open toggle_icon" alt="menu open">
      <img src="/assets/images/times.png" class="close toggle_icon hidden" alt="menu close">
    </button>
  </div>
</header><main class="page-content docs" aria-label="Content"><aside class="sidebar_left">
  <nav>
    <h2>Sections</h2>

    <ul class="aside_nav" id="aside_nav"><li>
        <a class="aside_nav_link" href="/docs/jupyter">Jupyter</a><span class="toggle_sub rot180"> &#94;</span>

        <ul class="sub_menu hidden"><li>
            <a class="aside_nav_link " href="/docs/repo2docker">repo2docker</a></li><li>
            <a class="aside_nav_link " href="/docs/fastpages">fastpages</a></li><li class="active">
            <a class="aside_nav_link  active" href="/docs/papermill">papermill</a></li></ul></li><li>
        <a class="aside_nav_link" href="/docs/k8s">Kubernetes</a><span class="toggle_sub rot180"> &#94;</span>

        <ul class="sub_menu hidden"><li>
            <a class="aside_nav_link " href="/docs/Argo">Argo</a></li><li>
            <a class="aside_nav_link " href="/docs/k8s-self-hosted-runner">Self-Hosted K8s Actions Runner</a></li></ul></li><li>
        <a class="aside_nav_link" href="/docs/experiment-tracking">Experiment Tracking</a><span class="toggle_sub rot180"> &#94;</span>

        <ul class="sub_menu hidden"><li>
            <a class="aside_nav_link " href="/docs/wandb">Weights & Biases</a></li></ul></li></ul>
  </nav>
</aside><article class="h-entry document" itemscope itemtype="http://schema.org/BlogPosting">
  <div>
    <header class="doc_header">
      <h1 class="doc_title p-name" itemprop="name headline">papermill</h1>
    </header>

    <div class="doc_content e-content" itemprop="articleBody">
      <h2 id="refresh-jupyter-notebooks-with-papermill">Refresh Jupyter Notebooks With <a href="https://github.com/nteract/papermill">Papermill</a></h2>

<p><a href="https://github.com/nteract/papermill">papermill</a> is a great project for running notebooks programatically.  You can pass parameters to notebooks, use different kernels, etc.</p>

<h3 id="example-refresh-notebooks-every-6-hours">Example: refresh notebooks every 6 hours</h3>

<p>Put a shell script at the location<code class="language-plaintext highlighter-rouge">_action_files/run_notebooks.sh</code> with the following contents:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/sh</span>
<span class="nb">set</span> <span class="nt">-e</span>
<span class="nb">cd</span> <span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span>/..
<span class="nb">cd </span>_notebooks/

<span class="nv">ERRORS</span><span class="o">=</span><span class="s2">""</span>

<span class="c"># Loop through all notebooks and run them with papermill</span>
<span class="k">for </span>file <span class="k">in</span> <span class="k">*</span>.ipynb
<span class="k">do
    if </span>papermill <span class="nt">--kernel</span> python3 <span class="s2">"</span><span class="k">${</span><span class="nv">file</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">file</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Sucessfully refreshed </span><span class="k">${</span><span class="nv">file</span><span class="k">}</span><span class="se">\n\n\n\n</span><span class="s2">"</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"ERROR Refreshing </span><span class="k">${</span><span class="nv">file</span><span class="k">}</span><span class="s2">"</span>
        <span class="nv">ERRORS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">ERRORS</span><span class="k">}</span><span class="s2">, </span><span class="k">${</span><span class="nv">file</span><span class="k">}</span><span class="s2">"</span>
    <span class="k">fi
done</span>

<span class="c"># Emit Errors If Exists So Downstream Task Can Open An Issue</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$ERRORS</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"::set-output name=error_bool::false"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"These files failed to update properly: </span><span class="k">${</span><span class="nv">ERRORS</span><span class="k">}</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"::set-output name=error_bool::true"</span>
    <span class="nb">echo</span> <span class="s2">"::set-output name=error_str::</span><span class="k">${</span><span class="nv">ERRORS</span><span class="k">}</span><span class="s2">"</span>
<span class="k">fi</span>
</code></pre></div></div>

<p>In the location <code class="language-plaintext highlighter-rouge">.github/workflows/update-nb.yaml</code> define an Actions workflow with the following contents</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Update Notebooks And Refresh Page</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span>  <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">*/6</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">update-notebooks</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
  

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Copy Repository Contents</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="m">3.6</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">install dependencies</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">pip3 install -r ./_notebooks/requirements.txt</span>
        <span class="s">python3 -m ipykernel install --user --name python3</span>
        <span class="s">sudo chmod -R 777 .</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">update notebooks</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">update_nb</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">./_action_files/run_notebooks.sh</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create an issue if notebook update failure occurs</span>
      <span class="na">if</span><span class="pi">:</span> <span class="s">steps.update_nb.outputs.error_bool == 'true'</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@0.6.0</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">github-token</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">var err = process.env.ERROR_STRING;</span>
          <span class="s">var run_id = process.env.RUN_ID;</span>
          <span class="s">github.issues.create({</span>
            <span class="s">owner: context.repo.owner,</span>
            <span class="s">repo: context.repo.repo,</span>
            <span class="s">title: "Error updating notebooks",</span>
            <span class="s">body: `These are the notebooks that failed to update properly: \n${err}\n\n See run [${run_id}](https://github.com/github/covid19-dashboard/actions/runs/${run_id}) for more details.`</span>
          <span class="s">})</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">ERROR_STRING</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">RUN_ID</span><span class="pi">:</span> <span class="s">$</span>

</code></pre></div></div>

<p>This example is based on <a href="https://covid19dashboards.com/">covid19dashboards.com</a>, which uses <a href="https://github.com/fastai/fastpages">fastpages</a> and papermill to refresh notebooks and serve them as dasbhoards.  You can see browse the <a href="https://github.com/github/covid19-dashboard/tree/master/.github/workflows">workflow files</a> of this project to see how papermill is used.</p>

    </div>
  </div>
  <a class="u-url" href="/docs/papermill" hidden></a>

  <aside class="sidebar_right">
    
    </nav>
  </aside>
</article>
  </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="footer_wrapper">

    <!-- <h2 class="footer-heading">Machine Learning Ops</h2> -->

    <div class="footer_grid">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Machine Learning Ops</li><li><a class="u-email" href="mailto:"></a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/github"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">github</span></a></li><li><a href="https://www.twitter.com/github"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">github</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A collection of resources on how to facilitate Machine Learning Ops with GitHub.</p>
      </div>
    </div>

  </div>

</footer><script src="/assets/js/common.js"></script>
</body>

</html>